<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ë¡œì´ê°€ ë§Œë“  ìœ íŠœë¸Œ ì±„ë„ ëª¨ë‹ˆí„°</title>
<link rel="icon" href="favicon.ico"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.45/moment-timezone-with-data.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
/* CSSëŠ” ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬í•  ì˜ˆì •ì´ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ê¸°ë³¸ë§Œ */
:root {
  --brand: #c4302b;
  --bg: #0f0f23;
  --card: #1a1a2e;
  --text: #e4e6ea;
  --border: #3a3a5c;
  --gradient-mutant: linear-gradient(135deg, #ff4757 0%, #ffa502 50%, #2ed573 100%);
}

body.dark { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; }
.container { max-width: 1600px; margin: 24px auto; background: var(--card); padding: 32px; border-radius: 24px; }
h1 { text-align: center; font-size: 2.5rem; background: var(--gradient-mutant); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.btn { padding: 8px 16px; border-radius: 12px; cursor: pointer; transition: all 0.3s; }
</style>
</head>
<body class="dark">
<div class="container">
  <h1>ë¡œì´ê°€ ë§Œë“  ìœ íŠœë¸Œ ì±„ë„ ëª¨ë‹ˆí„°</h1>
  <div class="single-header">
    <button id="btn-analyze" class="analyze-btn">ì±„ë„ ë¶„ì„</button>
    <div class="row">
      <button id="btn-api" class="api-btn">API í‚¤ ì…ë ¥</button>
      <button id="btn-toggle-theme" class="toggle-btn">ë¼ì´íŠ¸ ëª¨ë“œ</button>
    </div>
  </div>

  <div id="main-content" class="three-col">
    <section class="col" data-col="channels">
      <div class="col-head" draggable="true">
        <h2>ì±„ë„ ì¶”ê°€</h2>
        <div class="col-actions">
          <button id="btn-add-channel" class="btn">+ ì±„ë„ ì¶”ê°€</button> 
          <button id="btn-export-channels" class="btn">ë‚´ë³´ë‚´ê¸°</button> 
          <button id="btn-import-channels" class="btn">ê°€ì ¸ì˜¤ê¸°</button> 
          <input type="file" id="file-import-channels" accept="application/json" style="display:none" />
          <span>ë“±ë¡: <span id="channel-count">0</span></span>
        </div>
      </div>
      <div class="sort-row">
        <label>ì •ë ¬:
          <select id="sort-channels">
            <option value="subscribers" selected>êµ¬ë…ììˆ˜</option>
            <option value="videos">ì˜ìƒê°¯ìˆ˜</option>
            <option value="latest">ìµœê·¼ì—…ë¡œë“œ</option>
          </select>
        </label>
      </div>
      <div id="channel-list" class="channel-list"><p class="muted">ì±„ë„ì„ ì¶”ê°€í•˜ì„¸ìš”.</p></div>
      <div id="channel-pagination" class="pagination"></div>
    </section>

    <section class="col" data-col="mutant">
      <div class="col-head" draggable="true">
        <h2>ëŒì—°ë³€ì´ ì˜ìƒ</h2>
        <div class="col-actions">
          <div class="date-range">
            <button data-period="1m">1ê°œì›”</button>
            <button data-period="3m">3ê°œì›”</button>
            <button class="active" data-period="6m">6ê°œì›”</button>
            <button data-period="all">ì „ì²´</button>
          </div>
        </div>
      </div>
      <div class="sort-row">
        <label>ì •ë ¬:
          <select id="sort-mutant">
            <option value="mutantIndex" selected>ëŒì—°ë³€ì´ì§€ìˆ˜</option>
            <option value="views">ì¡°íšŒìˆ˜</option>
            <option value="subscribers">êµ¬ë…ììˆ˜</option>
            <option value="latest">ìµœê·¼ì—…ë¡œë“œ</option>
          </select>
        </label>
      </div>
      <div id="mutant-keywords" class="keywords"></div>
      <div id="mutant-list" class="video-list"><p class="muted">ì±„ë„ì„ ì¶”ê°€í•˜ì—¬ ì˜ìƒì„ ë¶„ì„í•´ì£¼ì„¸ìš”.</p></div>
      <div id="mutant-pagination" class="pagination"></div>
    </section>

    <section class="col" data-col="latest">
      <div class="col-head" draggable="true"><h2>ìµœì‹  ì˜ìƒ</h2></div>
      <div class="sort-row">
        <label>ì •ë ¬:
          <select id="sort-latest">
            <option value="views" selected>ì¡°íšŒìˆ˜</option>
            <option value="subscribers">êµ¬ë…ììˆ˜</option>
            <option value="latest">ìµœê·¼ì—…ë¡œë“œ</option>
            <option value="mutantIndex">ëŒì—°ë³€ì´ì§€ìˆ˜</option>
          </select>
        </label>
      </div>
      <div id="latest-keywords" class="keywords"></div>
      <div id="latest-list" class="video-list"><p class="muted">ì±„ë„ì„ ì¶”ê°€í•˜ì—¬ ì˜ìƒì„ ë¶„ì„í•´ì£¼ì„¸ìš”.</p></div>
      <div id="latest-pagination" class="pagination"></div>
    </section>
  </div>
</div>

<!-- ëª¨ë‹¬ë“¤ -->
<div id="modal-api" class="modal" style="display:none">
  <div class="content">
    <span class="close" data-close="modal-api">Ã—</span>
    <h3>API í‚¤ ì…ë ¥</h3>
    <p>ìµœëŒ€ 5ê°œê¹Œì§€ ì €ì¥í•˜ê³  ìë™ ìˆœí™˜ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
    <div id="api-inputs" class="api-inputs"></div>
    <div class="row" style="margin-top:8px">
      <input type="file" id="api-file" accept=".txt" style="display:none"/>
      <button id="api-file-btn" class="file-label" type="button">API í‚¤ ì—…ë¡œë“œ(.txt)</button>
      <button id="api-save" class="btn" type="button">ì €ì¥</button>
      <button id="api-download" class="btn" type="button">ë‹¤ìš´ë¡œë“œ</button>
      <button id="api-test" class="btn" type="button">API í‚¤ í…ŒìŠ¤íŠ¸</button>
    </div>
    <div id="api-test-result" class="small"></div>
  </div>
</div>

<div id="modal-add" class="modal" style="display:none">
  <div class="content">
    <span class="close" data-close="modal-add">Ã—</span>
    <h3>ì±„ë„ ì¶”ê°€</h3>
    <div class="tabs">
      <button class="tab active" data-tab="tab-ch-search">ì±„ë„ëª… ê²€ìƒ‰</button>
      <button class="tab" data-tab="tab-vid-search">ì˜ìƒ ê²€ìƒ‰(ë¡±í¼ë§Œ)</button>
      <button class="tab" data-tab="tab-url-add">URL ì§ì ‘ ì…ë ¥</button>
    </div>
    <div id="tab-ch-search" class="tabpanel active">
      <div class="row"><input id="ch-query" class="search-input" placeholder="ì±„ë„ëª…ìœ¼ë¡œ ê²€ìƒ‰"/><button id="btn-ch-search" class="btn">ê²€ìƒ‰</button><span style="flex:1"></span><label style="font-size:12px">ì •ë ¬: <select id="ch-sort"><option value="subs" selected>êµ¬ë…ììˆœ</option><option value="videos">ì˜ìƒìˆ˜ìˆœ</option><option value="latest">ìµœì‹ ì—…ë¡œë“œìˆœ</option></select></label></div>
      <div id="ch-results" class="result-list"></div>
      <div id="ch-pagination" class="pagination"></div>
    </div>
    <div id="tab-vid-search" class="tabpanel">
      <div class="row"><input id="vid-query" class="search-input" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥(ë¡±í¼ë§Œ í‘œì‹œ)"/><button id="btn-vid-search" class="btn">ê²€ìƒ‰</button></div>
      <div id="vid-results" class="result-list"></div>
      <div id="vid-pagination" class="pagination"></div>
    </div>
    <div id="tab-url-add" class="tabpanel">
      <div class="row">
        <input id="url-input" class="search-input" placeholder="ì±„ë„ URL ë˜ëŠ” ì±„ë„ ID ì…ë ¥"/>
        <button id="btn-url-add" class="btn">ì¶”ê°€</button>
      </div>
      <div id="url-result"></div>
    </div>
  </div>
</div>

<div id="modal-analyze" class="modal" style="display:none">
  <div class="content">
    <span class="close" data-close="modal-analyze">Ã—</span>
    <h3>ë¶„ì„í•  ì±„ë„ ì„ íƒ</h3>
    <p class="muted">ë¶„ì„ì„ ì›í•˜ëŠ” ì±„ë„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
    <div id="analyze-channel-list" class="result-list"></div>
  </div>
</div>

<div id="toast" class="toast" style="display:none"></div>

<script>
// ì„¤ì • ë° ì „ì—­ ë³€ìˆ˜
if (typeof moment !== 'undefined') {
  moment.tz.setDefault('Asia/Seoul');
}

window.CONFIG = {
  API_BASE: 'https://www.googleapis.com/youtube/v3/',
  PAGINATION: { CHANNELS: 8, VIDEOS: 5, SEARCH_CHANNELS: 4, SEARCH_VIDEOS: 4 },
  TIMEOUT: 30000,
  MUTANT_THRESHOLD: 2.0
};

window.state = {
  currentMutantPeriod: '6m',
  currentView: 'home',
  currentPage: { channels: 1, mutant: 1, latest: 1 }
};

window.apiKeys = JSON.parse(localStorage.getItem('youtubeApiKeys') || localStorage.getItem('apiKeys') || '[]');
window.keyIdx = 0;

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
window.qs = id => document.getElementById(id);
window.fmt = n => { 
  const x = parseInt(n || '0', 10); 
  return isNaN(x) ? '0' : x.toLocaleString(); 
};
window.seconds = iso => moment.duration(iso).asSeconds();

const stopWords = new Set([
  'ì€', 'ëŠ”', 'ì´', 'ê°€', 'ì„', 'ë¥¼', 'ì—', 'ì˜', 'ì™€', 'ê³¼', 'ë„', 'ë¡œ', 'ìœ¼ë¡œ',
  'the', 'a', 'an', 'of', 'to', 'in', 'on', 'for', 'and', 'or', 'but', 'with', 'about',
  'ì—ì„œ', 'ê°™ì€', 'ë¿', 'ìœ„í•´', 'í•©ë‹ˆë‹¤', 'í–ˆë‹¤', 'í•˜ëŠ”', 'í•˜ê¸°', 'ì§„ì§œ', 'ë¬´ë„ˆì¡Œë‹¤', 'into'
]);

function toast(msg, ms = 1800) {
  const t = qs('toast');
  if (t) {
    t.textContent = msg;
    t.style.display = 'block';
    setTimeout(() => t.style.display = 'none', ms);
  }
}

function extractKeywords(text) {
  const freq = new Map();
  if (!text) return [];
  
  text.replace(/[#"'.!?()/\-:;[\]{}|<>~^%$@*&+=]/g, ' ')
    .split(/\s+/)
    .forEach(w => {
      w = w.trim().toLowerCase();
      const hasKo = /[ê°€-í£]/.test(w);
      if (!w) return;
      if ((hasKo && w.length < 2) || (!hasKo && w.length < 3)) return;
      if (stopWords.has(w)) return;
      freq.set(w, (freq.get(w) || 0) + 1);
    });
    
  return [...freq.entries()]
    .filter(([word, count]) => count > 1)
    .sort((a, b) => b[1] - a[1]);
}

function truncateText(text, maxLength) {
  if (!text || text.length <= maxLength) return text;
  return text.substring(0, maxLength - 3) + '...';
}

// API í•¨ìˆ˜
async function yt(endpoint, params, attempt = 0) {
  if (!window.apiKeys.length) {
    throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
  }
  
  const ctrl = new AbortController();
  const timeout = setTimeout(() => ctrl.abort('timeout'), CONFIG.TIMEOUT);
  
  const p = new URLSearchParams(params);
  p.set('key', window.apiKeys[window.keyIdx]);
  const url = CONFIG.API_BASE + endpoint + '?' + p.toString();
  
  try {
    const r = await fetch(url, { signal: ctrl.signal });
    const data = await r.json();
    clearTimeout(timeout);
    
    if (data.error) {
      if (data.error.code === 403 && /quota/i.test(data.error.message || '')) {
        throw new Error('API í• ë‹¹ëŸ‰ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
      if (attempt < window.apiKeys.length - 1) {
        window.keyIdx = (window.keyIdx + 1) % window.apiKeys.length;
        return yt(endpoint, params, attempt + 1);
      }
      throw new Error(data.error.message || 'API ì˜¤ë¥˜');
    }
    return data;
  } catch (e) {
    clearTimeout(timeout);
    if (attempt < window.apiKeys.length - 1) {
      window.keyIdx = (window.keyIdx + 1) % window.apiKeys.length;
      return yt(endpoint, params, attempt + 1);
    }
    throw e;
  }
}

// IndexedDB ê´€ë¦¬
let db = null;

function openDB() {
  return new Promise((resolve, reject) => {
    if (db) return resolve(db);
    const request = indexedDB.open('myChannelDB', 4);
    
    request.onupgradeneeded = e => {
      db = e.target.result;
      if (!db.objectStoreNames.contains('my_channels')) {
        db.createObjectStore('my_channels', { keyPath: 'id' });
      }
      if (!db.objectStoreNames.contains('insights')) {
        db.createObjectStore('insights', { keyPath: 'channelId' });
      }
      if (!db.objectStoreNames.contains('dailySubs')) {
        db.createObjectStore('dailySubs', { keyPath: ['channelId', 'date'] });
      }
      if (!db.objectStoreNames.contains('doneVideos')) {
        db.createObjectStore('doneVideos', { keyPath: ['channelId', 'videoId'] });
      }
    };
    
    request.onsuccess = e => {
      db = e.target.result;
      resolve(db);
    };
    
    request.onerror = e => reject(e);
  });
}

function idbAll(store) {
  return openDB().then(db => new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readonly');
    const s = tx.objectStore(store);
    const q = s.getAll();
    q.onsuccess = () => resolve(q.result);
    q.onerror = () => reject(q.error);
  }));
}

function idbGet(store, key) {
  return openDB().then(db => new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readonly');
    const s = tx.objectStore(store);
    const q = s.get(key);
    q.onsuccess = () => resolve(q.result);
    q.onerror = () => reject(q.error);
  }));
}

function idbPut(store, obj) {
  return openDB().then(db => new Promise((resolve, reject) => {
    try {
      const tx = db.transaction(store, 'readwrite');
      const s = tx.objectStore(store);
      const q = s.put(obj);
      q.onsuccess = () => resolve();
      q.onerror = () => reject(q.error);
    } catch (e) {
      reject(e);
    }
  }));
}

function idbDel(store, key) {
  return openDB().then(db => new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readwrite');
    const s = tx.objectStore(store);
    const q = s.delete(key);
    q.onsuccess = () => resolve();
    q.onerror = () => reject(q.error);
  }));
}

// ì±„ë„ ë¶„ì„ í•¨ìˆ˜ (ì™„ì „í•œ ê¸°ëŠ¥)
async function startAnalysis(channelId) {
  const container = document.body.querySelector('.container');
  const mainContent = qs('main-content');
  if (mainContent) mainContent.style.display = 'none';
  
  // ê¸°ì¡´ ë¶„ì„ ì„¹ì…˜ ì œê±°
  const existingAnalysis = qs('analysis-section');
  if (existingAnalysis) existingAnalysis.remove();
  
  const loadingDiv = document.createElement('div');
  loadingDiv.id = 'analysis-section';
  loadingDiv.className = 'analysis-page';
  loadingDiv.innerHTML = `
    <div class="loading-text">
      <div class="loading"></div>
      ì±„ë„ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
    </div>`;
  container.appendChild(loadingDiv);
  
  window.state.currentView = 'analysis';
  
  try {
    const ch = await idbGet('my_channels', channelId);
    if (!ch) throw new Error('ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    
    // ì±„ë„ ë¶„ì„ ë°ì´í„° ìˆ˜ì§‘
    const analysisData = await performCompleteAnalysis(ch);
    
    // UI ë Œë”ë§
    renderCompleteAnalysis(ch, analysisData);
    
  } catch (e) {
    qs('analysis-section').innerHTML = `
      <button id="btn-back-home" class="btn" onclick="showHome()">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      <div class="error-message" style="text-align: center; margin-top: 40px;">
        ì±„ë„ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e.message}
      </div>`;
    console.error(e);
  }
}

async function performCompleteAnalysis(channel) {
  const subscriberCount = parseInt(channel.subscriberCount || '1');
  
  // 1. ìµœê·¼ 100ê°œ ì˜ìƒ ë°ì´í„° ìˆ˜ì§‘
  const videos = await getLongformVideos(channel.uploadsPlaylistId, 100);
  
  // 2. ê¸°ë³¸ í†µê³„
  const totalViews = videos.reduce((sum, v) => sum + parseInt(v.statistics.viewCount || 0), 0);
  const avgViews = totalViews / videos.length || 0;
  const avgDuration = videos.reduce((sum, v) => sum + (moment.duration(v.contentDetails.duration).asSeconds() || 0), 0) / videos.length || 0;
  
  // 3. ìƒìœ„ ì˜ìƒë“¤
  const topVideos = [...videos].sort((a, b) => parseInt(b.statistics.viewCount) - parseInt(a.statistics.viewCount)).slice(0, 10);
  
  // 4. ëŒì—°ë³€ì´ ì˜ìƒë“¤ (êµ¬ë…ì ëŒ€ë¹„ ë†’ì€ ì¡°íšŒìˆ˜)
  const mutantVideos = videos.filter(v => {
    const views = parseInt(v.statistics.viewCount || 0);
    return views >= (subscriberCount * CONFIG.MUTANT_THRESHOLD);
  });
  
  // 5. ì—…ë¡œë“œ íŒ¨í„´ ë¶„ì„
  const weeklyUploads = new Array(7).fill(0);
  const hourlyUploads = new Array(24).fill(0);
  const monthlyUploads = new Array(12).fill(0);
  
  videos.forEach(v => {
    const publishedMoment = moment(v.snippet.publishedAt);
    weeklyUploads[publishedMoment.day()]++;
    hourlyUploads[publishedMoment.hour()]++;
    monthlyUploads[publishedMoment.month()]++;
  });
  
  // 6. ì°¸ì—¬ë„ ë¶„ì„
  const totalLikes = videos.reduce((sum, v) => sum + parseInt(v.statistics.likeCount || 0), 0);
  const totalComments = videos.reduce((sum, v) => sum + parseInt(v.statistics.commentCount || 0), 0);
  const engagementRate = totalViews > 0 ? ((totalLikes + totalComments) / totalViews * 100) : 0;
  
  // 7. ì¹´í…Œê³ ë¦¬ ë¶„ì„
  const categories = {};
  videos.forEach(v => {
    const cat = v.snippet.categoryId || 'ë¯¸ë¶„ë¥˜';
    categories[cat] = (categories[cat] || 0) + 1;
  });
  
  // 8. í‚¤ì›Œë“œ ë¶„ì„
  const allTitles = videos.map(v => v.snippet.title).join(' ');
  const keywords = extractKeywords(allTitles).slice(0, 20);
  
  // 9. ì„±ì¥ ë¶„ì„
  const recentVideos = videos.slice(0, 10);
  const olderVideos = videos.slice(-10);
  const recentAvgViews = recentVideos.reduce((sum, v) => sum + parseInt(v.statistics.viewCount || 0), 0) / recentVideos.length || 0;
  const olderAvgViews = olderVideos.reduce((sum, v) => sum + parseInt(v.statistics.viewCount || 0), 0) / olderVideos.length || 0;
  const viewsGrowthRate = olderAvgViews > 0 ? ((recentAvgViews - olderAvgViews) / olderAvgViews * 100) : 0;
  
  // 10. ìµœì  ì—…ë¡œë“œ ì‹œê°„ ì°¾ê¸°
  const bestDay = weeklyUploads.indexOf(Math.max(...weeklyUploads));
  const bestHour = hourlyUploads.indexOf(Math.max(...hourlyUploads));
  const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
  
  return {
    // ê¸°ë³¸ í†µê³„
    totalViews,
    avgViews,
    avgDuration,
    totalVideos: videos.length,
    engagementRate,
    viewsGrowthRate,
    
    // ì˜ìƒ ë°ì´í„°
    topVideos,
    mutantVideos,
    recentVideos: videos.slice(0, 5),
    
    // íŒ¨í„´ ë¶„ì„
    weeklyUploads,
    hourlyUploads,
    monthlyUploads,
    bestUploadTime: `${dayNames[bestDay]} ${bestHour}ì‹œ`,
    
    // ì½˜í…ì¸  ë¶„ì„
    keywords,
    categories,
    
    // ì„±ê³¼ ë¶„ì„
    topPerformingDay: dayNames[bestDay],
    uploadConsistency: Math.max(...weeklyUploads) / Math.min(...weeklyUploads.filter(x => x > 0)) || 1
  };
}

function renderCompleteAnalysis(channel, data) {
  const analysisSection = qs('analysis-section');
  
  analysisSection.innerHTML = `
    <div class="analysis-header">
      <button id="btn-back-home" class="nav-btn" onclick="showHome()">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      <img class="thumb" src="${channel.thumbnail}" alt="${channel.title}">
      <div class="info">
        <h2>${channel.title}</h2>
        <p>êµ¬ë…ì: ${fmt(channel.subscriberCount)}ëª…</p>
        <div class="analysis-stats">
          <div class="stat-item">
            <div class="stat-value">${fmt(Math.round(data.avgViews))}</div>
            <div class="stat-label">í‰ê·  ì¡°íšŒìˆ˜</div>
          </div>
          <div class="stat-item">
            <div class="stat-value ${data.viewsGrowthRate >= 0 ? 'positive' : 'negative'}">${data.viewsGrowthRate >= 0 ? '+' : ''}${data.viewsGrowthRate.toFixed(1)}%</div>
            <div class="stat-label">ì¡°íšŒìˆ˜ ì„±ì¥ë¥ </div>
          </div>
          <div class="stat-item">
            <div class="stat-value">${data.engagementRate.toFixed(2)}%</div>
            <div class="stat-label">ì°¸ì—¬ë„</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">${Math.round(data.avgDuration / 60)}</div>
            <div class="stat-label">í‰ê·  ê¸¸ì´(ë¶„)</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="analysis-content">
      <div class="analysis-card">
        <h3>ğŸ“Š í•µì‹¬ ì„±ê³¼ ì§€í‘œ</h3>
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-value positive">${data.mutantVideos.length}</div>
            <div class="metric-label">ëŒì—°ë³€ì´ ì˜ìƒ</div>
          </div>
          <div class="metric-card">
            <div class="metric-value neutral">${fmt(data.totalViews)}</div>
            <div class="metric-label">ì´ ì¡°íšŒìˆ˜</div>
          </div>
          <div class="metric-card">
            <div class="metric-value neutral">${data.totalVideos}</div>
            <div class="metric-label">ë¶„ì„ ì˜ìƒìˆ˜</div>
          </div>
          <div class="metric-card">
            <div class="metric-value neutral">${data.uploadConsistency.toFixed(1)}x</div>
            <div class="metric-label">ì—…ë¡œë“œ ì¼ê´€ì„±</div>
          </div>
        </div>
      </div>
      
      <div class="analysis-card">
        <h3>ğŸ”¥ ìƒìœ„ ì„±ê³¼ ì˜ìƒ</h3>
        <div class="analysis-videos">
          <div class="video-list">
            ${data.topVideos.map(v => `
              <div class="analysis-video-card">
                <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank">
                  <img src="${v.snippet.thumbnails.medium.url}" alt="${v.snippet.title}">
                </a>
                <div class="analysis-video-meta">
                  <h4>${truncateText(v.snippet.title, 60)}</h4>
                  <p>ì¡°íšŒìˆ˜: ${fmt(v.statistics.viewCount)} Â· ${moment(v.snippet.publishedAt).fromNow()}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
      
      <div class="analysis-card">
        <h3>ğŸš€ ëŒì—°ë³€ì´ ì˜ìƒ (${data.mutantVideos.length}ê°œ)</h3>
        <div class="analysis-videos">
          <div class="video-list">
            ${data.mutantVideos.slice(0, 5).map(v => `
              <div class="analysis-video-card">
                <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank">
                  <img src="${v.snippet.thumbnails.medium.url}" alt="${v.snippet.title}">
                </a>
                <div class="analysis-video-meta">
                  <h4>${truncateText(v.snippet.title, 60)}</h4>
                  <p>ì¡°íšŒìˆ˜: ${fmt(v.statistics.viewCount)} Â· ëŒì—°ë³€ì´ì§€ìˆ˜: ${(parseInt(v.statistics.viewCount) / parseInt(channel.subscriberCount)).toFixed(2)}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
      
      <div class="analysis-card">
        <h3>ğŸ“… ì—…ë¡œë“œ íŒ¨í„´ ë¶„ì„</h3>
        <div class="chart-container">
          <canvas id="weekly-upload-chart"></canvas>
        </div>
        <div class="chart-label">ìš”ì¼ë³„ ì—…ë¡œë“œ íŒ¨í„´</div>
        <p style="text-align: center; margin-top: 16px; color: var(--brand); font-weight: 600;">
          ìµœì  ì—…ë¡œë“œ ì‹œê°„: ${data.bestUploadTime}
        </p>
      </div>
      
      <div class="analysis-card">
        <h3>ğŸ·ï¸ ì£¼ìš” í‚¤ì›Œë“œ</h3>
        <div class="tag-cloud">
          ${data.keywords.map(([word, count]) => `
            <span class="tag" style="font-size: ${Math.min(1.5, 0.8 + count * 0.1)}rem">${word} (${count})</span>
          `).join('')}
        </div>
      </div>
      
      <div class="analysis-card">
        <h3>â° ì‹œê°„ëŒ€ë³„ ì—…ë¡œë“œ</h3>
        <div class="chart-container">
          <canvas id="hourly-upload-chart"><!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ë¡œì´ê°€ ë§Œë“  ìœ íŠœë¸Œ ì±„ë„ ëª¨ë‹ˆí„°</title>
<link rel="icon" href="favicon.ico"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.45/moment-timezone-with-data.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
/* CSS ë‚´ìš©ì€ ë°©ê¸ˆ ë§Œë“  enhanced_styles.css ë‚´ìš©ì„ ì—¬ê¸°ì— ì‚½ì… */
/* í…Œë§ˆ ë³€ìˆ˜ */
:root {
  --brand: #c4302b;
  --brand-light: #e74c3c;
  --brand-dark: #a02622;
  --bg: #f6f7fb;
  --card: #fff;
  --muted: #888;
  --shadow: 0 6px 22px rgba(0,0,0,.07);
  --shadow-hover: 0 12px 40px rgba(0,0,0,.12);
  --pastel1: #fff6f1;
  --pastel2: #f1fbff;
  --pastel3: #f8fff4;
  --text: #333;
  --border: #f0f0f0;
  --placeholder: #ccc;
  --modal-bg: rgba(0,0,0,.45);
  --gradient-mutant: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 50%, #6bcf7f 100%);
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --gradient-warning: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --gradient-info: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  --glass-bg: rgba(255, 255, 255, 0.25);
  --glass-border: rgba(255, 255, 255, 0.18);
}

/* ë‚˜ì´íŠ¸ ëª¨ë“œ ë³€ìˆ˜ */
body.dark {
  --bg: #0f0f23;
  --card: #1a1a2e;
  --muted: #b0b3b8;
  --shadow: 0 6px 22px rgba(0,0,0,.4);
  --shadow-hover: 0 12px 40px rgba(0,0,0,.6);
  --pastel1: #2d1b69;
  --pastel2: #0f3460;
  --pastel3: #16213e;
  --text: #e4e6ea;
  --border: #3a3a5c;
  --placeholder: #65676b;
  --modal-bg: rgba(0,0,0,.7);
  --gradient-mutant: linear-gradient(135deg, #ff4757 0%, #ffa502 50%, #2ed573 100%);
  --gradient-primary: linear-gradient(135deg, #4b79a1 0%, #283c86 100%);
  --gradient-success: linear-gradient(135deg, #0072ff 0%, #00c6ff 100%);
  --gradient-warning: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
  --gradient-info: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
  --glass-bg: rgba(26, 26, 46, 0.4);
  --glass-border: rgba(255, 255, 255, 0.1);
}

/* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
* { box-sizing: border-box; }

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes shine {
  0% { left: -100%; }
  100% { left: 100%; }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.container {
  max-width: 1600px;
  margin: 24px auto;
  background: var(--card);
  padding: 32px;
  border-radius: 24px;
  box-shadow: var(--shadow);
  animation: fadeInUp 0.6s ease-out;
  position: relative;
}

.container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-mutant);
  border-radius: 24px 24px 0 0;
}

h1 {
  margin: 0 0 32px;
  text-align: center;
  color: var(--brand);
  font-size: 2.5rem;
  font-weight: 800;
  letter-spacing: -1px;
  background: var(--gradient-mutant);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: float 3s ease-in-out infinite;
}

.single-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  gap: 16px;
  padding: 16px 24px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  border: 1px solid var(--glass-border);
}

.api-btn, .analyze-btn, .toggle-btn {
  background: var(--gradient-primary);
  color: #fff;
  border: 0;
  border-radius: 12px;
  padding: 12px 24px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.analyze-btn {
  background: var(--gradient-mutant);
}

.toggle-btn {
  background: var(--gradient-warning);
}

.btn:hover, .api-btn:hover, .analyze-btn:hover, .toggle-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.three-col {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
}

@media (max-width: 768px) {
  .three-col { grid-template-columns: 1fr; }
}

.col {
  background: var(--card);
  border-radius: 20px;
  box-shadow: var(--shadow);
  padding: 24px;
  border: 1px solid var(--border);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.col:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-hover);
}

.col-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid var(--border);
  padding-bottom: 16px;
  margin-bottom: 16px;
}

.btn {
  border: 2px solid var(--border);
  background: var(--card);
  color: var(--brand);
  border-radius: 12px;
  padding: 8px 16px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
}

.btn:hover {
  background: var(--brand);
  color: #fff;
}

.btn-danger {
  background: var(--gradient-warning);
  color: #fff;
  border: none;
}

/* ì±„ë„ ì¹´ë“œ */
.channel-card {
  display: grid;
  grid-template-columns: 72px 1fr auto;
  gap: 20px;
  align-items: center;
  border: 2px solid var(--border);
  background: var(--glass-bg);
  border-radius: 20px;
  padding: 20px;
  transition: all 0.3s;
  margin-bottom: 16px;
}

.channel-card:hover {
  transform: translateY(-4px);
  border-color: var(--brand);
}

.channel-thumb {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  border: 3px solid var(--brand);
}

/* ì˜ìƒ ì¹´ë“œ */
.video-card {
  border-radius: 20px;
  box-shadow: var(--shadow);
  background: var(--card);
  border: 2px solid var(--border);
  transition: all 0.4s;
  margin-bottom: 20px;
}

.video-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-hover);
}

.video-link {
  display: block;
  color: inherit;
  text-decoration: none;
  padding: 20px;
}

.thumb {
  width: 100%;
  aspect-ratio: 16/9;
  border-radius: 12px;
  transition: transform 0.4s;
}

.video-card:hover .thumb {
  transform: scale(1.05);
}

.v-title {
  font-weight: 700;
  margin: 16px 4px 12px;
  font-size: 1.1rem;
}

.v-meta {
  display: grid;
  grid-template-rows: auto auto;
  gap: 12px;
}

.v-meta-top {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  text-align: center;
}

.v-meta-top > span {
  padding: 8px 12px;
  background: var(--glass-bg);
  border-radius: 12px;
  font-weight: 600;
  border: 1px solid var(--border);
}

.v-meta-bottom {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  align-items: center;
  text-align: center;
}

.mutant-badge {
  background: var(--gradient-mutant);
  color: #fff;
  border-radius: 25px;
  padding: 8px 16px;
  font-weight: 800;
  position: relative;
  overflow: hidden;
  animation: pulse 2s infinite;
}

.mutant-badge::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100
