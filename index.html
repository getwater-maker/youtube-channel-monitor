<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>로이가 만든 유튜브 채널 모니터</title>
  <link rel="icon" href="favicon.svg" />
  
  <!-- CSS 파일 -->
  <link rel="stylesheet" href="css/styles.css" />

  <!-- 외부 라이브러리 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.45/moment-timezone-with-data.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.js"></script>
</head>

<body class="dark">
  <div class="container">
    <!-- 헤더 -->
    <header>
      <div class="header-content">
        <div class="logo-section">
          <div class="logo-icon">Y</div>
          <h1>유튜브 채널 모니터</h1>
        </div>
        <nav class="nav-buttons">
          <button id="btn-my-channels" class="btn btn-my-channel nav-section">👥 내채널들</button>
          <button id="btn-channels" class="btn btn-secondary nav-section active">📺 채널관리</button>
          <button id="btn-videos" class="btn btn-secondary nav-section">🎥 영상분석</button>
          <button id="btn-text-splitter" class="btn btn-secondary">✂️ 텍스트 분할</button>
          <!-- 🔹 새 기능 버튼 추가 -->
          <button id="btn-scene-parser" class="btn btn-secondary nav-section">🖼️ 씬 프롬프트</button>
          <button id="btn-analyze" class="btn btn-primary">📊 채널 분석</button>
          <button id="btn-toggle-theme" class="btn btn-secondary">라이트 모드</button>
          <button id="btn-api" class="btn btn-secondary">🔑 API 키</button>
        </nav>
      </div>
    </header>

    <!-- 메인 콘텐츠 -->
    <main id="main-content" class="section-view">
      <!-- 내채널들 섹션 (새로 추가) -->
      <section class="section" id="section-my-channels" data-section="my-channels" style="display: none;">
        <div class="section-header">
          <h2>👥 내 채널들</h2>
          <div class="section-actions">
            <button id="btn-add-oauth-channel" class="btn btn-primary">➕ 채널 연동</button>
            <button id="btn-demo-channels" class="btn btn-secondary">🎯 데모 체험</button>
            <button id="btn-export-all-channels" class="btn btn-secondary">📥 전체 내보내기</button>
          </div>
        </div>
        
        <!-- 내채널 콘텐츠 -->
        <div id="my-channels-content">
          <!-- my-channels.js에서 동적으로 생성됨 -->
        </div>
      </section>

      <!-- 채널 관리 섹션 -->
      <section class="section" id="section-channels" data-section="channels">
        <div class="section-header">
          <h2>📺 채널 관리</h2>
          <div class="section-actions">
            <button id="btn-add-channel" class="btn btn-primary">+ 채널 추가</button> 
            <button id="btn-export-channels" class="btn btn-secondary">📥 내보내기</button> 
            <button id="btn-import-channels" class="btn btn-secondary">📤 가져오기</button> 
            <input type="file" id="file-import-channels" accept="application/json" style="display:none" />
            <span class="channel-count-wrapper">등록: <span id="channel-count">0</span>개</span>
          </div>
        </div>
        
        <div class="sort-row">
          <label for="sort-channels">정렬:
            <select id="sort-channels">
              <option value="subscribers" selected>구독자수</option>
              <option value="videos">영상갯수</option>
              <option value="latest">최근업로드</option>
            </select>
          </label>
        </div>
        
        <div id="channel-list" class="channel-list horizontal-grid">
          <div class="empty-state">
            <div class="empty-icon">📺</div>
            <p class="muted">채널을 추가하여 시작하세요</p>
            <button class="btn btn-primary" onclick="document.getElementById('btn-add-channel').click()">첫 채널 추가하기</button>
          </div>
        </div>
        
        <div id="channel-pagination" class="pagination"></div>
      </section>

      <!-- 통합 영상 분석 섹션 -->
      <section class="section" id="section-videos" data-section="videos" style="display: none;">
        <div class="section-header">
          <h2>🎥 영상 분석</h2>
          <div class="section-actions">
            <div class="video-filter-tabs">
  <!-- 정렬 선택 (돌연변이 앞으로 이동) -->
  <select id="sort-videos" style="margin-right: 16px; padding: 6px 12px; border: 2px solid var(--border); border-radius: 6px; background: var(--card); color: var(--text); font-weight: 600;">
    <option value="views">조회수</option>
    <option value="subscribers">구독자수</option>
    <option value="latest">최근업로드</option>
    <option value="mutantIndex">돌연변이지수</option>
  </select>
  
  <button class="video-tab" data-video-tab="mutant">🚀 돌연변이</button>
  <button class="video-tab active" data-video-tab="latest">📱 최신영상</button>
  
  <!-- 조회수 기준 필터 (새로 추가) -->
  <div class="views-range" style="margin-left: 16px;">
    <button class="views-btn" data-views="10000">1만</button>
    <button class="views-btn" data-views="30000">3만</button>
    <button class="views-btn active" data-views="50000">5만</button>
  </div>
  
  <!-- 기간 필터 -->
  <div class="date-range" style="margin-left: 8px;">
    <button class="period-btn" data-period="1w">1주</button>
    <button class="period-btn" data-period="2w">2주</button>
    <button class="period-btn active" data-period="1m">한달</button>
    <button class="period-btn" data-period="all">전체</button>
  </div>
  
  <!-- 다시불러오기만 남김 (현재페이지 다운로드 버튼 삭제) -->
  <div class="video-actions-group" style="margin-left: 16px;">
    <button id="btn-refresh-videos" class="btn btn-primary">🔄 다시불러오기</button>
  </div>
</div>
          </div>
        </div>

        <!-- 돌연변이 탭 -->
        <div id="video-tab-mutant" class="video-tab-content">
          <div id="mutant-keywords" class="keywords"></div>
          <div id="mutant-list" class="video-list horizontal-grid">
            <div class="empty-state">
              <div class="empty-icon">🚀</div>
              <p class="muted">채널을 추가하여 영상을 분석해주세요</p>
            </div>
          </div>
          <div id="mutant-pagination" class="pagination"></div>
        </div>

        <!-- 최신영상 탭 -->
        <div id="video-tab-latest" class="video-tab-content active">
          <div id="latest-keywords" class="keywords"></div>
          <div id="latest-list" class="video-list horizontal-grid">
            <div class="empty-state">
              <div class="empty-icon">📱</div>
              <p class="muted">채널을 추가하여 영상을 분석해주세요</p>
            </div>
          </div>
          <div id="latest-pagination" class="pagination"></div>
        </div>
      </section>

      <!-- 텍스트 분할 섹션 -->
      <section class="section" id="section-text-splitter" data-section="text-splitter" style="display: none;">
        <div class="section-header">
          <h2>✂️ 텍스트 분할기</h2>
          <div class="section-actions">
            <span style="color: var(--muted); font-size: 14px;">덩어리 기준 · 최대 10,000자</span>
          </div>
        </div>

        <div class="text-splitter-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; height: calc(100vh - 200px);">
          <!-- 입력 영역 -->
          <div class="text-input-area" style="display: flex; flex-direction: column;">
            <label for="source-text" style="font-weight: 600; margin-bottom: 8px;">입력 텍스트</label>
            <textarea 
              id="source-text" 
              placeholder="여기에 텍스트를 붙여넣으세요. (# 또는 ##로 덩어리를 구분합니다)"
              style="flex: 1; resize: none; padding: 16px; border-radius: 12px; border: 2px solid var(--border); background: var(--card); color: var(--text); line-height: 1.6; font-size: 14px; font-family: ui-sans-serif, system-ui, sans-serif;"
            ></textarea>
            
            <div class="input-controls" style="margin-top: 16px;">
              <div class="counts" style="display: flex; gap: 16px; margin-bottom: 12px; font-size: 13px; color: var(--muted);">
                <span>글자수(공백 포함): <strong id="count-with-spaces">0</strong></span>
                <span>글자수(공백 미포함): <strong id="count-without-spaces">0</strong></span>
              </div>
              
              <div style="display: flex; gap: 12px;">
                <button id="btn-process-text" class="btn btn-primary">나누기</button>
                <button id="btn-clear-text" class="btn btn-secondary">지우기</button>
              </div>
              
              <div class="help-text" style="margin-top: 12px; font-size: 12px; color: var(--muted); line-height: 1.4;">
                <strong>사용법:</strong> 입력 → 가공(<code>*</code>, <code>---</code> 제거 / <code>#</code> 또는 <code>##</code>로 시작하는 줄은 <b>"씰씰"</b>으로 대체) → <code>#</code>~다음 <code>#</code> 사이를 <b>덩어리</b>로 묶고, 덩어리 합계 기준으로 최대 10,000자씩 분할
              </div>
            </div>
          </div>

          <!-- 결과 영역 -->
          <div class="text-output-area" style="display: flex; flex-direction: column;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
              <label style="font-weight: 600;">분할 결과</label>
              <span style="font-size: 12px; color: var(--muted);">덩어리 기준 · 최대 10,000자</span>
            </div>
            
            <div id="text-chunks" style="flex: 1; overflow-y: auto; padding: 16px; background: var(--card); border: 2px solid var(--border); border-radius: 12px;">
              <div id="empty-chunks-state" style="text-align: center; color: var(--muted); padding: 40px 20px;">
                아직 결과가 없습니다. 왼쪽에서 텍스트를 입력하고 <strong>나누기</strong>를 눌러주세요.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 🔹 씬 프롬프트 파서 섹션 -->
      <section class="section" id="section-scene-parser" data-section="scene-parser" style="display: none;">
        <div class="section-header">
          <h2>🖼️ 씬 프롬프트 파서</h2>
<div class="section-actions">
  <!-- 날짜 입력 + 파일 저장 + 지우기 -->
  <input type="date" id="scene-date" class="input-date" />
  <button id="scene-save" class="btn btn-primary">파일 저장</button>
  <button id="scene-clear" class="btn btn-secondary">지우기</button>
</div>

        </div>

        <!-- 2분할 레이아웃 -->
        <div class="scene-parser-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; height: calc(100vh - 200px);">
          <!-- 입력 영역 -->
          <div class="scene-input-area" style="display: flex; flex-direction: column;">
            <label for="scene-input" style="font-weight: 600; margin-bottom: 8px;">입력 텍스트</label>
            <textarea
              id="scene-input"
              placeholder="[1 ~ 2] 또는 [7] 같은 구간만 있어도 됩니다. 결과에는 따옴표 안의 이미지 프롬프트만 표시됩니다."
              style="flex: 1; resize: none; padding: 16px; border-radius: 12px; border: 2px solid var(--border); background: var(--card); color: var(--text); line-height: 1.6; font-size: 14px; font-family: ui-sans-serif, system-ui, sans-serif;"
            ></textarea>
            <div class="help-text" style="margin-top: 12px; font-size: 12px; color: var(--muted); line-height: 1.4;">
              <strong>규칙:</strong> ① '이미지 프롬프트:' 라벨 뒤 첫 따옴표 구절 우선 ② 없다면 블록 내 가장 긴 따옴표 구절을 사용합니다. ③ 따옴표는 제거되어 표시됩니다.
            </div>
          </div>

          <!-- 결과 영역 -->
          <div class="scene-output-area" style="display: flex; flex-direction: column;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
              <label style="font-weight: 600;">결과</label>
              <span style="font-size: 12px; color: var(--muted);">이미지 프롬프트</span>
            </div>

            <div class="table-wrap" style="flex: 1; overflow-y: auto; border: 2px solid var(--border); border-radius: 12px; background: var(--card);">
              <table style="width:100%; border-collapse: collapse;">
                <thead>
                  <tr style="position: sticky; top: 0; background: #0f1622;">
                    <th class="col-scene" style="text-align:left; padding: 12px; border-bottom: 1px solid var(--border); width: 140px; white-space: nowrap;">씬구간</th>
                    <th class="col-prompt" style="text-align:left; padding: 12px; border-bottom: 1px solid var(--border);">이미지 프롬프트 (따옴표 안 값만)</th>
                    <th style="text-align:left; padding: 12px; border-bottom: 1px solid var(--border); width: 100px;">복사</th>
                  </tr>
                </thead>
                <tbody id="scene-tbody">
                  <tr><td colspan="3" class="empty" style="color: var(--muted); text-align:center; padding: 28px;">왼쪽에 입력을 붙여넣으세요.</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- API 키 모달 -->
  <div id="modal-api" class="modal">
    <div class="modal-content">
      <span class="close" data-close="modal-api">&times;</span>
      <h3>🔑 YouTube API 키 설정</h3>
      <p class="modal-description">
        YouTube Data API v3 키를 입력하세요. 
        <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color: var(--brand);">Google Cloud Console</a>에서 발급받을 수 있습니다.
      </p>
      
      <div class="api-input-section">
        <div id="api-inputs"></div>
        <div class="api-file-actions" style="display: flex; gap: 8px; margin: 16px 0; justify-content: center;">
          <button id="api-export" class="btn btn-secondary">📥 키 내보내기</button>
          <button id="api-import-btn" class="btn btn-secondary">📤 키 가져오기</button>
          <input type="file" id="api-import-file" accept=".json,.txt" style="display:none">
        </div>
      </div>
      
      <div class="modal-actions">
        <button id="api-save" class="btn btn-primary">💾 저장</button>
        <button id="api-test" class="btn btn-secondary">🧪 테스트</button>
      </div>
      <div id="api-test-result"></div>
    </div>
  </div>

  <!-- 채널 추가 모달 -->
  <div id="modal-add" class="modal">
    <div class="modal-content modal-large">
      <span class="close" data-close="modal-add">&times;</span>
      <h3>📺 채널 추가</h3>
      
      <div class="add-tabs">
        <button class="add-tab active" data-add-tab="url">채널명/URL 검색</button>
      </div>
      
      <div id="add-tab-url" class="add-tab-content active">
        <div class="input-group">
          <input type="text" id="url-input" placeholder="채널명을 입력하세요 (예: 봉준호, 백종원)" />
          <button id="btn-url-add" class="btn btn-primary">🔍 검색</button>
        </div>
        <div id="url-result"></div>
        <div class="examples">
          <h4>🎯 채널명으로 쉽게 추가하세요!</h4>
          <div style="background: var(--glass-bg); padding: 16px; border-radius: 8px; margin: 12px 0;">
            <p style="margin: 0 0 12px 0; font-weight: 600; color: var(--brand);">💡 가장 많이 사용하는 방법:</p>
            <ul style="margin: 8px 0; color: var(--text);">
              <li><strong>한국어 채널명:</strong> "봉준호", "백종원", "쯔양" 등</li>
              <li><strong>영어 채널명:</strong> "Google Developers", "TED" 등</li>
              <li><strong>핸들명:</strong> "@GoogleDevelopers", "@ted" 등</li>
            </ul>
          </div>
          <details style="margin-top: 16px;">
            <summary style="cursor: pointer; color: var(--muted); font-size: 14px;">🔧 고급 옵션 보기</summary>
            <ul style="margin-top: 12px; font-size: 13px; color: var(--muted);">
              <li>채널 ID: <code>UC_x5XG1OV2P6uZZ5FSM9Ttw</code></li>
              <li>채널 URL: <code>https://youtube.com/channel/UC_x5XG1OV2P6uZZ5FSM9Ttw</code></li>
              <li>영상 URL: <code>https://youtube.com/watch?v=dQw4w9WgXcQ</code></li>
            </ul>
          </details>
        </div>
      </div>
    </div>
  </div>

  <!-- 분석 모달 -->
  <div id="modal-analyze" class="modal">
    <div class="modal-content">
      <span class="close" data-close="modal-analyze">&times;</span>
      <h3>📊 채널 분석</h3>
      <p class="modal-description">분석할 채널을 선택하세요. 심층 분석에는 시간이 소요될 수 있습니다.</p>
      <div id="analyze-channel-list" class="analyze-list"></div>
    </div>
  </div>

  <!-- JavaScript 파일들 -->
  <script src="js/common.js"></script>
  <script src="js/channels.js"></script>
  <script src="js/videos.js"></script>
  <script src="js/main-monitor.js"></script>
  <script src="js/navigation.js"></script>
  <script src="js/my-channels.js"></script>
  <script src="js/oauth-manager.js"></script>
  <script src="js/text-splitter.js"></script>
  <!-- 🔹 씬 프롬프트 파서 로딩 -->
  <script src="js/scene-parser.js"></script>
  <script src="js/main.js"></script>

  <script>
    console.log('스크립트 로딩 상태 확인:', {
      yt: typeof window.yt,
      getAllChannels: typeof window.getAllChannels,
      refreshVideos: typeof window.refreshVideos,
      extractChannelId: typeof window.extractChannelId,
      openAnalyzeModal: typeof window.openAnalyzeModal,
      initializeMyChannels: typeof window.initializeMyChannels,
      initializeTextSplitter: typeof window.initializeTextSplitter,
      moment: typeof moment,
      Chart: typeof Chart,
      Sortable: typeof Sortable
    });
    setTimeout(() => {
      if (typeof window.diagnoseApp === 'function') {
        window.diagnoseApp();
      }
    }, 3000);
  </script>
</body>
</html>
